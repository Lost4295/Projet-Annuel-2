CREATE DATABASE IF NOT EXISTS "website";
USE "website";
CREATE TABLE SCP_service (id INT AUTO_INCREMENT NOT NULL, prestataire_id INT NOT NULL, titre VARCHAR(255) NOT NULL, description LONGTEXT NOT NULL, type INT NOT NULL, tarifs LONGTEXT NOT NULL, avg_note VARCHAR(4) NOT NULL, additional_info LONGTEXT DEFAULT NULL, images JSON DEFAULT NULL COMMENT '(DC2Type:json)', INDEX IDX_7DF353DABE3DB2B7 (prestataire_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_abonnement (id INT AUTO_INCREMENT NOT NULL, nom VARCHAR(255) NOT NULL, tarif NUMERIC(5, 2) NOT NULL, image VARCHAR(255) DEFAULT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_abonnement_SCP_option (SCP_abonnement_id INT NOT NULL, SCP_option_id INT NOT NULL, INDEX IDX_14C6A746D6718D70 (SCP_abonnement_id), INDEX IDX_14C6A7468DA5711D (SCP_option_id), PRIMARY KEY(SCP_abonnement_id, SCP_option_id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_api (id INT AUTO_INCREMENT NOT NULL, url VARCHAR(255) DEFAULT NULL, isdown TINYINT(1) NOT NULL, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_appartement (id INT AUTO_INCREMENT NOT NULL, bailleur_id INT NOT NULL, description LONGTEXT NOT NULL, short_desc VARCHAR(100) NOT NULL, price DOUBLE PRECISION NOT NULL, address VARCHAR(255) NOT NULL, city VARCHAR(255) NOT NULL, postal_code VARCHAR(255) NOT NULL, country VARCHAR(255) NOT NULL, nb_voyageurs SMALLINT NOT NULL, note DOUBLE PRECISION NOT NULL, state VARCHAR(50) NOT NULL, images JSON DEFAULT NULL COMMENT '(DC2Type:json)', titre VARCHAR(255) NOT NULL, nbchambers SMALLINT NOT NULL, nbbathrooms SMALLINT NOT NULL, nb_beds SMALLINT NOT NULL, created_at DATETIME DEFAULT NULL, updated_at DATETIME DEFAULT NULL, surface DOUBLE PRECISION NOT NULL, INDEX IDX_28ABA1EB57B5D0A2 (bailleur_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;       
CREATE TABLE scp_appartement_appart_plus (SCP_appartement_id INT NOT NULL, SCP_appart_plus_id INT NOT NULL, INDEX IDX_BC0DFE9435EE0D91 (SCP_appartement_id), INDEX 
IDX_BC0DFE948A0270C8 (SCP_appart_plus_id), PRIMARY KEY(SCP_appartement_id, SCP_appart_plus_id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_appart_plus (id INT AUTO_INCREMENT NOT NULL, icon SMALLINT NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_commentaire (id INT AUTO_INCREMENT NOT NULL, user_id INT DEFAULT NULL, commentaire LONGTEXT NOT NULL, type SMALLINT NOT NULL, entity_id INT NOT NULL, date DATETIME NOT NULL, INDEX IDX_3EFD74DAA76ED395 (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;     
CREATE TABLE SCP_devis (id INT AUTO_INCREMENT NOT NULL, user_id INT DEFAULT NULL, prestataire_id INT DEFAULT NULL, nom VARCHAR(255) NOT NULL, prenom VARCHAR(255) NOT NULL, numero VARCHAR(10) NOT NULL, email VARCHAR(255) NOT NULL, type_presta SMALLINT NOT NULL, contact_with_phone TINYINT(1) NOT NULL, description LONGTEXT DEFAULT NULL, estimated_time VARCHAR(50) DEFAULT NULL, is_ok TINYINT(1) NOT NULL, start_date DATETIME DEFAULT NULL, end_date DATETIME DEFAULT NULL, to_validate TINYINT(1) DEFAULT NULL, sid LONGTEXT DEFAULT NULL, prix DOUBLE PRECISION DEFAULT NULL, turn TINYINT(1) DEFAULT NULL, INDEX IDX_99CCCDB0A76ED395 (user_id), INDEX IDX_99CCCDB0BE3DB2B7 (prestataire_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_email (id INT AUTO_INCREMENT NOT NULL, destinataire VARCHAR(255) NOT NULL, body LONGTEXT NOT NULL, object VARCHAR(255) NOT NULL, date DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_fichier (id INT AUTO_INCREMENT NOT NULL, email_id INT DEFAULT NULL, ticket_id INT DEFAULT NULL, user_id INT DEFAULT NULL, nom VARCHAR(100) NOT NULL, type VARCHAR(100) NOT NULL, path VARCHAR(255) NOT NULL, size VARCHAR(20) NOT NULL, date DATETIME NOT NULL, INDEX IDX_7189C17A832C1C9 (email_id), INDEX IDX_7189C17700047D2 (ticket_id), INDEX IDX_7189C17A76ED395 (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_location (id INT AUTO_INCREMENT NOT NULL, appartement_id INT NOT NULL, locataire_id INT NOT NULL, facture_id INT DEFAULT NULL, dateha DATETIME DEFAULT NULL, date_debut DATETIME NOT NULL, date_fin DATETIME NOT NULL, adults INT NOT NULL, kids INT NOT NULL, babies INT NOT NULL, price DOUBLE PRECISION NOT NULL, 
fact_to_create TINYINT(1) DEFAULT 0 NOT NULL, INDEX IDX_50D96F30E1729BBA (appartement_id), INDEX IDX_50D96F30D8A38199 (locataire_id), UNIQUE INDEX UNIQ_50D96F307F2DEE08 (facture_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_location_SCP_service (SCP_location_id INT NOT NULL, SCP_service_id INT NOT NULL, INDEX IDX_251D502B5F403DE8 (SCP_location_id), INDEX IDX_251D502B537DD89A (SCP_service_id), PRIMARY KEY(SCP_location_id, SCP_service_id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_note (id INT AUTO_INCREMENT NOT NULL, location_id INT DEFAULT NULL, user_id INT NOT NULL, service_id INT DEFAULT NULL, note INT NOT NULL, INDEX IDX_935C314D64D218E (location_id), INDEX IDX_935C314DA76ED395 (user_id), INDEX IDX_935C314DED5CA9E6 (service_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_option (id INT AUTO_INCREMENT NOT NULL, nom VARCHAR(255) NOT NULL, info VARCHAR(255) DEFAULT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 
COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_professionnel (id INT AUTO_INCREMENT NOT NULL, responsable_id INT DEFAULT NULL, society_name VARCHAR(255) NOT NULL, siret_number VARCHAR(14) NOT NULL, society_address VARCHAR(255) NOT NULL, city VARCHAR(255) NOT NULL, postal_code VARCHAR(10) NOT NULL, country VARCHAR(100) NOT NULL, image VARCHAR(255) DEFAULT NULL, avg_note VARCHAR(4) NOT NULL, work_days JSON DEFAULT NULL COMMENT '(DC2Type:json)', start_hour VARCHAR(20) DEFAULT NULL, end_hour VARCHAR(20) DEFAULT NULL, 
prestatype SMALLINT DEFAULT NULL, is_verified TINYINT(1) NOT NULL, justification LONGTEXT DEFAULT NULL, UNIQUE INDEX UNIQ_5D8E086C53C59D72 (responsable_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_reset_password_request (id INT AUTO_INCREMENT NOT NULL, user_id INT NOT NULL, selector VARCHAR(20) NOT NULL, hashed_token VARCHAR(100) NOT NULL, requested_at DATETIME NOT NULL COMMENT '(DC2Type:datetime_immutable)', expires_at DATETIME NOT NULL COMMENT '(DC2Type:datetime_immutable)', INDEX IDX_391B462DA76ED395 (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_ticket (id INT AUTO_INCREMENT NOT NULL, demandeur_id INT NOT NULL, resolveur_id INT DEFAULT NULL, date_ouverture DATETIME NOT NULL, date_fermeture DATETIME DEFAULT NULL, last_update_date DATETIME DEFAULT NULL, category SMALLINT NOT NULL, type SMALLINT NOT NULL, status SMALLINT NOT NULL, priority SMALLINT NOT NULL, titre VARCHAR(255) NOT NULL, description LONGTEXT NOT NULL, urgence SMALLINT NOT NULL, INDEX IDX_F06F0C6795A6EE59 (demandeur_id), INDEX IDX_F06F0C6735424616 (resolveur_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_user (id INT AUTO_INCREMENT NOT NULL, abonnement_id INT DEFAULT NULL, email VARCHAR(180) NOT NULL, roles JSON NOT NULL COMMENT '(DC2Type:json)', password VARCHAR(255) NOT NULL, nom VARCHAR(80) NOT NULL, prenom VARCHAR(80) NOT NULL, last_conn_date DATETIME DEFAULT NULL, creation_date DATETIME NOT NULL, admin 
TINYINT(1) NOT NULL, birthdate DATETIME DEFAULT NULL, is_verified TINYINT(1) NOT NULL, avatar LONGBLOB DEFAULT NULL, phone_number VARCHAR(255) NOT NULL, is_banned 
TINYINT(1) DEFAULT 0 NOT NULL, UNIQUE INDEX UNIQ_D1721D10E7927C74 (email), INDEX IDX_D1721D10F1D74413 (abonnement_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE SCP_warning (id INT AUTO_INCREMENT NOT NULL, user_id INT NOT NULL, field VARCHAR(255) NOT NULL, word VARCHAR(255) NOT NULL, date DATETIME NOT NULL, form VARCHAR(255) DEFAULT NULL, ip VARCHAR(50) DEFAULT NULL, INDEX IDX_DC2055CEA76ED395 (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
CREATE TABLE messenger_messages (id BIGINT AUTO_INCREMENT NOT NULL, body LONGTEXT NOT NULL, headers LONGTEXT NOT NULL, queue_name VARCHAR(190) NOT NULL, created_at DATETIME NOT NULL COMMENT '(DC2Type:datetime_immutable)', available_at DATETIME NOT NULL COMMENT '(DC2Type:datetime_immutable)', delivered_at DATETIME DEFAULT NULL COMMENT '(DC2Type:datetime_immutable)', INDEX IDX_75EA56E0FB7336F0 (queue_name), INDEX IDX_75EA56E0E3BD61CE (available_at), INDEX IDX_75EA56E016BA31DB (delivered_at), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;
ALTER TABLE SCP_service ADD CONSTRAINT FK_7DF353DABE3DB2B7 FOREIGN KEY (prestataire_id) REFERENCES SCP_professionnel (id);
ALTER TABLE SCP_abonnement_SCP_option ADD CONSTRAINT FK_14C6A746D6718D70 FOREIGN KEY (SCP_abonnement_id) REFERENCES SCP_abonnement (id) ON DELETE CASCADE;
ALTER TABLE SCP_abonnement_SCP_option ADD CONSTRAINT FK_14C6A7468DA5711D FOREIGN KEY (SCP_option_id) REFERENCES SCP_option (id) ON DELETE CASCADE;
ALTER TABLE SCP_appartement ADD CONSTRAINT FK_28ABA1EB57B5D0A2 FOREIGN KEY (bailleur_id) REFERENCES SCP_professionnel (id);
ALTER TABLE scp_appartement_appart_plus ADD CONSTRAINT FK_BC0DFE9435EE0D91 FOREIGN KEY (SCP_appartement_id) REFERENCES SCP_appartement (id) ON DELETE CASCADE;     
ALTER TABLE scp_appartement_appart_plus ADD CONSTRAINT FK_BC0DFE948A0270C8 FOREIGN KEY (SCP_appart_plus_id) REFERENCES SCP_appart_plus (id) ON DELETE CASCADE;     
ALTER TABLE SCP_commentaire ADD CONSTRAINT FK_3EFD74DAA76ED395 FOREIGN KEY (user_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_devis ADD CONSTRAINT FK_99CCCDB0A76ED395 FOREIGN KEY (user_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_devis ADD CONSTRAINT FK_99CCCDB0BE3DB2B7 FOREIGN KEY (prestataire_id) REFERENCES SCP_professionnel (id);
ALTER TABLE SCP_fichier ADD CONSTRAINT FK_7189C17A832C1C9 FOREIGN KEY (email_id) REFERENCES SCP_email (id);
ALTER TABLE SCP_fichier ADD CONSTRAINT FK_7189C17700047D2 FOREIGN KEY (ticket_id) REFERENCES SCP_ticket (id);
ALTER TABLE SCP_fichier ADD CONSTRAINT FK_7189C17A76ED395 FOREIGN KEY (user_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_location ADD CONSTRAINT FK_50D96F30E1729BBA FOREIGN KEY (appartement_id) REFERENCES SCP_appartement (id);
ALTER TABLE SCP_location ADD CONSTRAINT FK_50D96F30D8A38199 FOREIGN KEY (locataire_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_location ADD CONSTRAINT FK_50D96F307F2DEE08 FOREIGN KEY (facture_id) REFERENCES SCP_fichier (id);
ALTER TABLE SCP_location_SCP_service ADD CONSTRAINT FK_251D502B5F403DE8 FOREIGN KEY (SCP_location_id) REFERENCES SCP_location (id) ON DELETE CASCADE;
ALTER TABLE SCP_location_SCP_service ADD CONSTRAINT FK_251D502B537DD89A FOREIGN KEY (SCP_service_id) REFERENCES SCP_service (id) ON DELETE CASCADE;
ALTER TABLE SCP_note ADD CONSTRAINT FK_935C314D64D218E FOREIGN KEY (location_id) REFERENCES SCP_location (id);
ALTER TABLE SCP_note ADD CONSTRAINT FK_935C314DA76ED395 FOREIGN KEY (user_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_note ADD CONSTRAINT FK_935C314DED5CA9E6 FOREIGN KEY (service_id) REFERENCES SCP_service (id);
ALTER TABLE SCP_professionnel ADD CONSTRAINT FK_5D8E086C53C59D72 FOREIGN KEY (responsable_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_reset_password_request ADD CONSTRAINT FK_391B462DA76ED395 FOREIGN KEY (user_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_ticket ADD CONSTRAINT FK_F06F0C6795A6EE59 FOREIGN KEY (demandeur_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_ticket ADD CONSTRAINT FK_F06F0C6735424616 FOREIGN KEY (resolveur_id) REFERENCES SCP_user (id);
ALTER TABLE SCP_user ADD CONSTRAINT FK_D1721D10F1D74413 FOREIGN KEY (abonnement_id) REFERENCES SCP_abonnement (id);
ALTER TABLE SCP_warning ADD CONSTRAINT FK_DC2055CEA76ED395 FOREIGN KEY (user_id) REFERENCES SCP_user (id);